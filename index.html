<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Pio X Plataforma Escolar</title>
    <style>
        :root {
            --color-primario: #0d47a1;
            --color-secundario: #1976d2;
            --color-fondo: #e3f2fd;
            --color-texto: #333;
            --color-blanco: #ffffff;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: var(--color-fondo);
            color: var(--color-texto);
        }

        /* Pantalla de acceso */
        #pantalla-acceso {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .acceso-card {
            background: var(--color-blanco);
            padding: 20px;
            border-radius: 10px;
            max-width: 380px;
            width: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .acceso-card h1 {
            margin-top: 0;
            color: var(--color-primario);
            font-size: 1.4rem;
            text-align: center;
        }
        .acceso-card p {
            font-size: 0.9rem;
            color: #555;
            text-align: center;
        }
        .acceso-group {
            margin-top: 15px;
            font-size: 0.9rem;
        }
        .acceso-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: bold;
        }
        .acceso-opciones {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }
        .acceso-opciones label {
            font-weight: normal;
        }
        .acceso-input {
            width: 100%;
            padding: 8px;
            font-size: 0.9rem;
            border-radius: 4px;
            border: 1px solid #bbb;
        }
        .acceso-boton {
            width: 100%;
            margin-top: 15px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: var(--color-primario);
            color: var(--color-blanco);
            font-size: 0.95rem;
            cursor: pointer;
        }
        .acceso-boton:hover {
            background: var(--color-secundario);
        }
        .acceso-error {
            margin-top: 8px;
            color: #b71c1c;
            font-size: 0.8rem;
            min-height: 16px;
            text-align: center;
        }

        header {
            background: linear-gradient(135deg, var(--color-primario), var(--color-secundario));
            color: var(--color-blanco);
            padding: 20px;
            text-align: center;
        }
        header h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        header p {
            margin: 5px 0 0;
            font-size: 0.9rem;
        }
        nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            background: var(--color-primario);
        }
        nav a {
            color: var(--color-blanco);
            padding: 10px 14px;
            text-decoration: none;
            font-size: 0.9rem;
        }
        nav a:hover { background: var(--color-secundario); }
        .container {
            padding: 20px;
            max-width: 1100px;
            margin: 0 auto;
        }
        h2 {
            color: var(--color-primario);
            margin-top: 0;
        }
        .card {
            background: var(--color-blanco);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }
        .card ul { padding-left: 20px; }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.72rem;
            background: var(--color-secundario);
            color: var(--color-blanco);
            margin-right: 6px;
        }
        .info {
            font-size: 0.85rem;
            color: #555;
        }
        .tabla {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .tabla th,
        .tabla td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: left;
        }
        .tabla th {
            background: #bbdefb;
        }
        details summary {
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 5px;
        }
        details { margin-top: 10px; }
        .alerta {
            background: #fff3cd;
            border-left: 4px solid #ffca2c;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        .portada {
            margin: 15px 0 10px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }
        .portada img { width: 100%; display: block; }
        .portada-texto {
            text-align: center;
            font-size: 0.9rem;
            margin-top: 5px;
            color: #444;
        }
        .galeria {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .galeria img {
            width: 100%;
            border-radius: 8px;
            border: 2px solid var(--color-blanco);
            box-shadow: 0 1px 4px rgba(0,0,0,0.15);
        }
        .filtros {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            font-size: 0.85rem;
        }
        .filtros label { font-weight: bold; }
        .filtros select {
            padding: 4px 6px;
            font-size: 0.85rem;
        }
        .rol-indicador {
            font-size: 0.8rem;
            color: #eee;
            margin-top: 4px;
        }
        .resumen-estudiante {
            font-size: 0.85rem;
            background: #e3f2fd;
            border-left: 4px solid var(--color-secundario);
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .btn-tareas {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid var(--color-primario);
            background: var(--color-blanco);
            color: var(--color-primario);
            cursor: pointer;
            font-size: 0.8rem;
        }
        .btn-tareas:hover {
            background: var(--color-secundario);
            color: var(--color-blanco);
        }
        footer {
            background: var(--color-primario);
            color: var(--color-blanco);
            text-align: center;
            padding: 15px;
            margin-top: 40px;
            font-size: 0.8rem;
        }
        @media (max-width: 600px) {
            header h1 { font-size: 1.4rem; }
            nav a {
                font-size: 0.8rem;
                padding: 8px 10px;
            }
            .filtros {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>

<body>

<!-- PANTALLA DE ACCESO -->
<section id="pantalla-acceso">
    <div class="acceso-card">
        <h1>San Pio X Plataforma Escolar</h1>
        <p>Acceso a la información del 2º Año, paralelos A y B.</p>

        <div class="acceso-group">
            <label>Tipo de usuario</label>
            <div class="acceso-opciones">
                <label><input type="radio" name="rol" value="docente" checked> Docente / Administrador</label>
                <label><input type="radio" name="rol" value="familia"> Madre, padre o tutor</label>
            </div>
        </div>

        <div class="acceso-group">
            <label for="codigoAcceso">Código de acceso</label>
            <input type="password" id="codigoAcceso" class="acceso-input" placeholder="Ingrese el código">
        </div>

        <button class="acceso-boton" id="btnIngresar">Ingresar</button>
        <div class="acceso-error" id="mensajeError"></div>
    </div>
</section>

<!-- APLICACIÓN PRINCIPAL -->
<div id="app" style="display:none;">
    <header>
        <h1>San Pio X Plataforma Escolar</h1>
        <p>2º Año - Paralelos A y B · Administrado por <b>William &amp; Franklin</b></p>
        <div class="rol-indicador" id="textoRol"></div>
    </header>

    <nav>
        <a href="#bienvenida">Inicio</a>
        <a href="#guia">Guía para Padres</a>
        <a href="#a-notas" id="linkNotas2A">Notas 2ºA</a>
        <a href="#b-notas" id="linkNotas2B">Notas 2ºB</a>
        <a href="#a-tareas" id="linkTareas2A">Tareas 2ºA</a>
        <a href="#b-tareas" id="linkTareas2B">Tareas 2ºB</a>
        <a href="#asistencia">Asistencia</a>
        <a href="#comunicados">Comunicados</a>
        <a href="#material">Material de apoyo</a>
        <a href="#faq">Preguntas frecuentes</a>
    </nav>

    <div class="container">

        <div id="resumenEstudiante" class="resumen-estudiante" style="display:none;"></div>

        <!-- PORTADA -->
        <section class="card" id="portada">
            <h2>Portada</h2>
            <div class="portada">
                <img src="imagenes/portada-ejemplo.jpg" alt="Unidad Educativa San Pio X">
            </div>
            <p class="portada-texto">
                San Pio X · 2º Año A y B
            </p>
        </section>

        <!-- BIENVENIDA -->
        <section id="bienvenida" class="card">
            <h2>Bienvenida</h2>
            <p>Estimadas madres y padres de familia:</p>
            <p>
                Bienvenidos a la <b>San Pio X Plataforma Escolar</b>, un espacio para acompañar el proceso de aprendizaje
                de sus hijas e hijos de <b>2º Año, paralelos A y B</b>.
            </p>
            <p>Desde aquí podrán revisar:</p>
            <ul>
                <li>Notas por área y trimestre.</li>
                <li>Tareas vigentes y fechas de entrega.</li>
                <li>Asistencia y observaciones generales.</li>
                <li>Comunicados y avisos importantes.</li>
                <li>Material de apoyo para el estudio en casa.</li>
            </ul>
        </section>

        <!-- GUÍA PARA PADRES -->
        <section id="guia" class="card">
            <h2>Guía para Padres de Familia</h2>
            <ol>
                <li>
                    <b>Navegación básica</b><br>
                    Use el menú superior para ir a Notas, Tareas, Asistencia, Comunicados y Material de apoyo.
                </li>
                <li>
                    <b>Paralelo</b><br>
                    La plataforma diferencia entre <span class="badge">2ºA</span> y <span class="badge">2ºB</span>.
                </li>
                <li>
                    <b>Actualización</b><br>
                    Las notas se actualizan por trimestre; las tareas y la asistencia, de forma periódica.
                </li>
                <li>
                    <b>Uso responsable</b><br>
                    La información es de uso interno de la comunidad educativa.
                </li>
            </ol>

            <div class="alerta">
                Para familias, el código de acceso se basa en el primer apellido y nombre del estudiante.
            </div>
        </section>

        <!-- NOTAS 2ºA -->
        <section id="a-notas" class="card">
            <h2>Notas - 2ºA</h2>
            <p class="info" id="textoNotas2A">
                Filtros de estudiante, trimestre y área.
            </p>

            <div class="filtros" id="filtros2A">
                <label for="filtroAlumno2A">Estudiante:</label>
                <select id="filtroAlumno2A"></select>

                <label for="filtroTrimestre2A">Trimestre:</label>
                <select id="filtroTrimestre2A">
                    <option value="">Todos</option>
                    <option value="1º">1º</option>
                    <option value="2º">2º</option>
                    <option value="3º">3º</option>
                </select>

                <label for="filtroArea2A">Área:</label>
                <select id="filtroArea2A">
                    <option value="">Todas</option>
                    <option value="General">General</option>
                    <option value="Matemática">Matemática</option>
                    <option value="Lenguaje">Lenguaje</option>
                    <option value="Ciencias Sociales">Ciencias Sociales</option>
                    <option value="Ciencias Naturales">Ciencias Naturales</option>
                    <option value="Artes Plásticas">Artes Plásticas</option>
                </select>
            </div>

            <table class="tabla" id="tablaNotas2A">
                <thead>
                    <tr>
                        <th>Estudiante</th>
                        <th>Área</th>
                        <th>Trimestre</th>
                        <th>Nota</th>
                        <th>Observación</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <!-- NOTAS 2ºB -->
        <section id="b-notas" class="card">
            <h2>Notas - 2ºB</h2>
            <p class="info" id="textoNotas2B">
                Filtros de estudiante, trimestre y área.
            </p>

            <div class="filtros" id="filtros2B">
                <label for="filtroAlumno2B">Estudiante:</label>
                <select id="filtroAlumno2B"></select>

                <label for="filtroTrimestre2B">Trimestre:</label>
                <select id="filtroTrimestre2B">
                    <option value="">Todos</option>
                    <option value="1º">1º</option>
                    <option value="2º">2º</option>
                    <option value="3º">3º</option>
                </select>

                <label for="filtroArea2B">Área:</label>
                <select id="filtroArea2B">
                    <option value="">Todas</option>
                    <option value="General">General</option>
                    <option value="Matemática">Matemática</option>
                    <option value="Lenguaje">Lenguaje</option>
                    <option value="Ciencias Sociales">Ciencias Sociales</option>
                    <option value="Ciencias Naturales">Ciencias Naturales</option>
                    <option value="Artes Plásticas">Artes Plásticas</option>
                </select>
            </div>

            <table class="tabla" id="tablaNotas2B">
                <thead>
                    <tr>
                        <th>Estudiante</th>
                        <th>Área</th>
                        <th>Trimestre</th>
                        <th>Nota</th>
                        <th>Observación</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <!-- TAREAS 2ºA -->
        <section id="a-tareas" class="card">
            <h2>Tareas - 2ºA</h2>
            <p class="info">Tareas generales del paralelo 2ºA.</p>

            <div class="filtros">
                <button type="button" class="btn-tareas" data-target="tablaTareas2A" data-modo="recientes">
                    Tareas recientes (7 días)
                </button>
                <button type="button" class="btn-tareas" data-target="tablaTareas2A" data-modo="todas">
                    Todas las tareas
                </button>
            </div>

            <table class="tabla" id="tablaTareas2A">
                <thead>
                    <tr>
                        <th>Fecha asignación</th>
                        <th>Fecha entrega</th>
                        <th>Área</th>
                        <th>Descripción</th>
                        <th>Materiales</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>20/11/2025</td>
                        <td>22/11/2025</td>
                        <td>Matemática</td>
                        <td>Resolver 5 ejercicios de suma y resta.</td>
                        <td>Cuaderno, lápiz, borrador</td>
                    </tr>
                    <tr>
                        <td>10/11/2025</td>
                        <td>13/11/2025</td>
                        <td>Lenguaje</td>
                        <td>Redactar una pequeña descripción de su familia.</td>
                        <td>Cuaderno, lápiz</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- TAREAS 2ºB -->
        <section id="b-tareas" class="card">
            <h2>Tareas - 2ºB</h2>
            <p class="info">Tareas generales del paralelo 2ºB.</p>

            <div class="filtros">
                <button type="button" class="btn-tareas" data-target="tablaTareas2B" data-modo="recientes">
                    Tareas recientes (7 días)
                </button>
                <button type="button" class="btn-tareas" data-target="tablaTareas2B" data-modo="todas">
                    Todas las tareas
                </button>
            </div>

            <table class="tabla" id="tablaTareas2B">
                <thead>
                    <tr>
                        <th>Fecha asignación</th>
                        <th>Fecha entrega</th>
                        <th>Área</th>
                        <th>Descripción</th>
                        <th>Materiales</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>21/11/2025</td>
                        <td>24/11/2025</td>
                        <td>Ciencias Naturales</td>
                        <td>Dibujar una planta y señalar sus partes.</td>
                        <td>Hoja, colores</td>
                    </tr>
                    <tr>
                        <td>11/11/2025</td>
                        <td>14/11/2025</td>
                        <td>Ciencias Sociales</td>
                        <td>Investigar una costumbre de su comunidad.</td>
                        <td>Cuaderno, lápiz</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- ASISTENCIA -->
        <section id="asistencia" class="card">
            <h2>Asistencia - 2ºA y 2ºB</h2>
            <p class="info" id="textoAsistencia">
                Para docentes: puede marcar Presente, Atraso o Falta. Para familias: solo se muestra la asistencia del estudiante.
            </p>

            <table class="tabla" id="tablaAsistencia">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Estudiante</th>
                        <th>Paralelo</th>
                        <th>Estado</th>
                        <th>Observación</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <!-- COMUNICADOS -->
        <section id="comunicados" class="card">
            <h2>Comunicados</h2>
            <ul>
                <li>Reunión de padres de familia del paralelo 2ºA – 30/11/2025 a horas 18:00.</li>
                <li>Entrega de libretas del 1º trimestre – Fecha por confirmar.</li>
            </ul>

            <div class="galeria">
                <!-- Imágenes de comunicados cuando se agreguen -->
            </div>
        </section>

        <!-- MATERIAL DE APOYO -->
        <section id="material" class="card">
            <h2>Material de apoyo</h2>
            <ul>
                <li>Guías de lectura y escritura.</li>
                <li>Fichas de operaciones básicas de matemática.</li>
                <li>Enlaces a videos educativos seleccionados por los docentes.</li>
            </ul>
        </section>

        <!-- PREGUNTAS FRECUENTES -->
        <section id="faq" class="card">
            <h2>Preguntas frecuentes (FAQ)</h2>

            <details>
                <summary>¿Debo crear una cuenta para acceder?</summary>
                <p>No. Solo necesita el código de acceso.</p>
            </details>

            <details>
                <summary>¿Cada cuánto se actualizan las notas?</summary>
                <p>Las notas se actualizan por trimestre.</p>
            </details>

            <details>
                <summary>¿Qué hago si veo un error en los datos?</summary>
                <p>Debe comunicarse con los docentes por los canales oficiales.</p>
            </details>

            <details>
                <summary>¿Puedo compartir esta página?</summary>
                <p>Se recomienda compartir el enlace solo con madres, padres o tutores autorizados.</p>
            </details>
        </section>

    </div>

    <footer>
        San Pio X Plataforma Escolar · 2º Año A y B · Desarrollado por William &amp; Franklin
    </footer>
</div>

<!-- JAVASCRIPT -->
<script>
// Código docente (general)
const CODIGO_DOCENTE = "DOCENTE2025";

let rolActual = null;
let alumnoActual = null;
let paraleloActual = null;

// Normalizar clave de familia
function normalizarCodigoFamilia(str) {
    return str
        .toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .trim();
}

// Mapa de códigos individuales de familia
const codigosFamilia = {};
function registrarCodigo(clave, alumno, paralelo) {
    codigosFamilia[normalizarCodigoFamilia(clave)] = { alumno, paralelo };
}

// Registrar códigos por estudiante (primer apellido + nombre)
registrarCodigo("Balderrama Marcos", "Balderrama Choque Marcos Dyland", "2ºA");
registrarCodigo("Calle Zoe", "Calle  Pariguana Zoe Sofia", "2ºA");
registrarCodigo("Cardenas Dimar", "Cardenas Chacon Dimar Santos", "2ºA");
registrarCodigo("Ibanez Erik", "Ibañez Garnica Erik  Jhair", "2ºA");
registrarCodigo("Lopez Jonathan", "Lopez Vega  Jonathan Joseph", "2ºA");
registrarCodigo("Lovera Nataly", "Lovera Revollo Nataly", "2ºA");
registrarCodigo("Male Nazaline", "Male Rodas  Nazaline", "2ºA");
registrarCodigo("Mamani Cristan", "Mamani  Mendez Cristan", "2ºA");
registrarCodigo("Nunez Luis", "Nuñez Lopez Luis Yair", "2ºA");
registrarCodigo("Ontiveros Erick", "Ontiveros Rivera Erick Matias", "2ºA");
registrarCodigo("Ortega Marian", "Ortega Rivera Marian Valentina", "2ºA");
registrarCodigo("Ortiz Jhinaguissel", "Ortiz Encinas JhinaGuissel", "2ºA");
registrarCodigo("Poma Daira", "Poma  Vargas  Daira  Jasmin", "2ºA");
registrarCodigo("Ramos Sofia", "Ramos Miranda  Sofia", "2ºA");
registrarCodigo("Requelme Brillit", "Requelme Arancibia BRILLIT", "2ºA");
registrarCodigo("Rodas Ayned", "Rodas  Carballo Ayned  Masiel", "2ºA");
registrarCodigo("Ruiz Aysel", "Ruiz Rodas  Aysel", "2ºA");
registrarCodigo("Solis Marilet", "Solis  Salazar  Marilet", "2ºA");
registrarCodigo("Yamandiry Liam", "Yamandiry Diaz  Liam  Abdiel", "2ºA");

registrarCodigo("Aguilar Valentina", "AGUILAR VALENTINA MARGARITA", "2ºB");
registrarCodigo("Avila Erick", "AVILA PLATA ERICK JHOEL", "2ºB");
registrarCodigo("Ayllon Marines", "AYLLON HINOJOSA MARINES", "2ºB");
registrarCodigo("Ballejos Alison", "BALLEJOS REVOLLO ALISON DANAE", "2ºB");
registrarCodigo("Barja Zeineth", "BARJA LOPEZ ZEINETH", "2ºB");
registrarCodigo("Beltran Stiven", "BELTRAN LOPEZ  STIVEN FRANCO", "2ºB");
registrarCodigo("Carballo Ismael", "CARBALLO BERAMENDI ISMAEL", "2ºB");
registrarCodigo("Chavarria Paul", "CHAVARRIA BARJA PAUL THIAGO", "2ºB");
registrarCodigo("Copa Carlos", "COPA DIAZ CARLOS DANIEL", "2ºB");
registrarCodigo("Fernandez Vayolet", "FERNANDEZ VELASCO VAYOLET YARELY", "2ºB");
registrarCodigo("Flores Albaro", "FLORES QUIROGA ALBARO AARON", "2ºB");
registrarCodigo("Flores Rene", "FLORES OVANDO RENE ALI ", "2ºB");
registrarCodigo("Gonzales Emily", "GONZALES PANIAGUA EMILY CRISTAL", "2ºB");
registrarCodigo("Lopez Hesel", "LOPEZ RODAS HESEL AINOHA", "2ºB");
registrarCodigo("Miranda Eithan", "MIRANDA RUIZ EITHAN", "2ºB");
registrarCodigo("Ortega Jhon", "ORTEGA MOLINA JHON MAICOL", "2ºB");
registrarCodigo("Ortiz Fernanda", "ORTIZ CEREZO FERNANDA", "2ºB");
registrarCodigo("Pardo Dannely", "PARDO PADILLA DANNELY SARAI", "2ºB");
registrarCodigo("Quispe Jhosep", "QUISPE SANDOVAL JHOSEP", "2ºB");
registrarCodigo("Ruiz Erick", "RUIZ ALARCON ERICK MIJAEL", "2ºB");
registrarCodigo("Sardan Aysel", "SARDAN ZAMBRANA AYSEL DESIREE", "2ºB");
registrarCodigo("Vega Angel", "VEGA SALAZAR ANGEL GAEL ", "2ºB");
registrarCodigo("Zelaya Victoria", "ZELAYA SALAZAR VICTORIA MASSIEL", "2ºB");

// Datos base de notas (pueden editar trimestre, área, nota, obs)
const datosNotas2A = [
    { alumno: "Balderrama Choque Marcos Dyland", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Calle  Pariguana Zoe Sofia", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Cardenas Chacon Dimar Santos", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Ibañez Garnica Erik  Jhair", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Lopez Vega  Jonathan Joseph", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Lovera Revollo Nataly", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Male Rodas  Nazaline", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Mamani  Mendez Cristan", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Nuñez Lopez Luis Yair", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Ontiveros Rivera Erick Matias", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Ortega Rivera Marian Valentina", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Ortiz Encinas JhinaGuissel", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Poma  Vargas  Daira  Jasmin", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Ramos Miranda  Sofia", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Requelme Arancibia BRILLIT", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Rodas  Carballo Ayned  Masiel", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Ruiz Rodas  Aysel", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Solis  Salazar  Marilet", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "Yamandiry Diaz  Liam  Abdiel", area: "General", trimestre: "-", nota: "", obs: "" }
];

const datosNotas2B = [
    { alumno: "AGUILAR VALENTINA MARGARITA", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "AVILA PLATA ERICK JHOEL", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "AYLLON HINOJOSA MARINES", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "BALLEJOS REVOLLO ALISON DANAE", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "BARJA LOPEZ ZEINETH", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "BELTRAN LOPEZ  STIVEN FRANCO", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "CARBALLO BERAMENDI ISMAEL", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "CHAVARRIA BARJA PAUL THIAGO", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "COPA DIAZ CARLOS DANIEL", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "FERNANDEZ VELASCO VAYOLET YARELY", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "FLORES QUIROGA ALBARO AARON", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "FLORES OVANDO RENE ALI ", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "GONZALES PANIAGUA EMILY CRISTAL", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "LOPEZ RODAS HESEL AINOHA", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "MIRANDA RUIZ EITHAN", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "ORTEGA MOLINA JHON MAICOL", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "ORTIZ CEREZO FERNANDA", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "PARDO PADILLA DANNELY SARAI", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "QUISPE SANDOVAL JHOSEP", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "RUIZ ALARCON ERICK MIJAEL", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "SARDAN ZAMBRANA AYSEL DESIREE", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "VEGA SALAZAR ANGEL GAEL ", area: "General", trimestre: "-", nota: "", obs: "" },
    { alumno: "ZELAYA SALAZAR VICTORIA MASSIEL", area: "General", trimestre: "-", nota: "", obs: "" }
];

// Asistencia (ejemplo, editable)
const datosAsistencia = [
    { id: 1, fecha: "25/11/2025", alumno: "Balderrama Choque Marcos Dyland", paralelo: "2ºA", estado: "Presente", obs: "" },
    { id: 2, fecha: "25/11/2025", alumno: "Yamandiry Diaz  Liam  Abdiel", paralelo: "2ºA", estado: "Falta", obs: "Sin justificar" },
    { id: 3, fecha: "25/11/2025", alumno: "AGUILAR VALENTINA MARGARITA", paralelo: "2ºB", estado: "Presente", obs: "" },
    { id: 4, fecha: "25/11/2025", alumno: "ZELAYA SALAZAR VICTORIA MASSIEL", paralelo: "2ºB", estado: "Atraso", obs: "Justificada" }
];

// Utilidades
function obtenerListaAlumnos(datos) {
    const nombres = datos.map(d => d.alumno);
    return Array.from(new Set(nombres)).sort();
}

function llenarSelectAlumnos(selectId, datos) {
    const select = document.getElementById(selectId);
    select.innerHTML = "";
    const opcionTodos = document.createElement("option");
    opcionTodos.value = "";
    opcionTodos.textContent = "Todos los estudiantes";
    select.appendChild(opcionTodos);

    obtenerListaAlumnos(datos).forEach(nombre => {
        const opt = document.createElement("option");
        opt.value = nombre;
        opt.textContent = nombre;
        select.appendChild(opt);
    });
}

function renderTablaNotas(tablaId, datos, filtros = {}) {
    const tbody = document.querySelector(`#${tablaId} tbody`);
    tbody.innerHTML = "";

    let datosFiltrados = datos;

    if (filtros.alumno) {
        datosFiltrados = datosFiltrados.filter(d => d.alumno === filtros.alumno);
    }
    if (filtros.trimestre) {
        datosFiltrados = datosFiltrados.filter(d => d.trimestre === filtros.trimestre);
    }
    if (filtros.area) {
        datosFiltrados = datosFiltrados.filter(d => d.area === filtros.area);
    }

    if (datosFiltrados.length === 0) {
        const fila = document.createElement("tr");
        const celda = document.createElement("td");
        celda.colSpan = 5;
        celda.textContent = "No hay registros para mostrar.";
        fila.appendChild(celda);
        tbody.appendChild(fila);
        return;
    }

    datosFiltrados.forEach(d => {
        const fila = document.createElement("tr");

        const cAlumno = document.createElement("td");
        cAlumno.textContent = d.alumno;
        fila.appendChild(cAlumno);

        const cArea = document.createElement("td");
        cArea.textContent = d.area;
        fila.appendChild(cArea);

        const cTrim = document.createElement("td");
        cTrim.textContent = d.trimestre;
        fila.appendChild(cTrim);

        const cNota = document.createElement("td");
        cNota.textContent = d.nota;
        fila.appendChild(cNota);

        const cObs = document.createElement("td");
        cObs.textContent = d.obs || "";
        fila.appendChild(cObs);

        tbody.appendChild(fila);
    });
}

function renderTablaAsistencia(filtroNombre = "") {
    const tbody = document.querySelector("#tablaAsistencia tbody");
    tbody.innerHTML = "";

    let datosFiltrados = filtroNombre
        ? datosAsistencia.filter(d => d.alumno === filtroNombre)
        : datosAsistencia;

    if (datosFiltrados.length === 0) {
        const fila = document.createElement("tr");
        const celda = document.createElement("td");
        celda.colSpan = 5;
        celda.textContent = "No hay registros para mostrar.";
        fila.appendChild(celda);
        tbody.appendChild(fila);
        return;
    }

    datosFiltrados.forEach(d => {
        const fila = document.createElement("tr");

        const cFecha = document.createElement("td");
        cFecha.textContent = d.fecha;
        fila.appendChild(cFecha);

        const cAlumno = document.createElement("td");
        cAlumno.textContent = d.alumno;
        fila.appendChild(cAlumno);

        const cParalelo = document.createElement("td");
        cParalelo.textContent = d.paralelo;
        fila.appendChild(cParalelo);

        const cEstado = document.createElement("td");
        if (rolActual === "docente") {
            const sel = document.createElement("select");
            ["Presente", "Atraso", "Falta"].forEach(op => {
                const o = document.createElement("option");
                o.value = op;
                o.textContent = op;
                sel.appendChild(o);
            });
            sel.value = d.estado;
            sel.dataset.id = d.id;
            sel.addEventListener("change", (e) => {
                const id = parseInt(e.target.dataset.id, 10);
                const idx = datosAsistencia.findIndex(reg => reg.id === id);
                if (idx !== -1) {
                    datosAsistencia[idx].estado = e.target.value;
                }
            });
            cEstado.appendChild(sel);
        } else {
            cEstado.textContent = d.estado;
        }
        fila.appendChild(cEstado);

        const cObs = document.createElement("td");
        cObs.textContent = d.obs || "";
        fila.appendChild(cObs);

        tbody.appendChild(fila);
    });
}

function filtrarTareas(tablaId, modo) {
    const hoy = new Date();
    const filas = document.querySelectorAll(`#${tablaId} tbody tr`);
    filas.forEach(row => {
        if (modo === "todas") {
            row.style.display = "";
            return;
        }
        const fechaTexto = row.cells[0].textContent.trim(); // dd/mm/yyyy
        const partes = fechaTexto.split("/");
        if (partes.length !== 3) {
            row.style.display = "";
            return;
        }
        const dia = parseInt(partes[0], 10);
        const mes = parseInt(partes[1], 10) - 1;
        const anio = parseInt(partes[2], 10);
        const fecha = new Date(anio, mes, dia);
        const diffMs = hoy - fecha;
        const dias = diffMs / (1000 * 60 * 60 * 24);
        row.style.display = dias <= 7 ? "" : "none";
    });
}

// Actualizar tablas de notas según filtros
function actualizarNotas2A() {
    const trimestre = document.getElementById("filtroTrimestre2A").value;
    const area = document.getElementById("filtroArea2A").value;
    let alumnoFiltro = "";

    if (rolActual === "familia") {
        alumnoFiltro = (paraleloActual === "2ºA") ? alumnoActual : "";
    } else {
        alumnoFiltro = document.getElementById("filtroAlumno2A").value;
    }

    renderTablaNotas("tablaNotas2A", datosNotas2A, {
        alumno: alumnoFiltro,
        trimestre,
        area
    });
}

function actualizarNotas2B() {
    const trimestre = document.getElementById("filtroTrimestre2B").value;
    const area = document.getElementById("filtroArea2B").value;
    let alumnoFiltro = "";

    if (rolActual === "familia") {
        alumnoFiltro = (paraleloActual === "2ºB") ? alumnoActual : "";
    } else {
        alumnoFiltro = document.getElementById("filtroAlumno2B").value;
    }

    renderTablaNotas("tablaNotas2B", datosNotas2B, {
        alumno: alumnoFiltro,
        trimestre,
        area
    });
}

// Configurar vista para DOCENTE
function configurarVistaDocente() {
    const textoRol = document.getElementById("textoRol");
    const resumen = document.getElementById("resumenEstudiante");
    resumen.style.display = "none";

    textoRol.textContent = "Acceso: Docente / Administrador";

    document.getElementById("filtros2A").style.display = "flex";
    document.getElementById("filtros2B").style.display = "flex";

    document.getElementById("a-notas").style.display = "block";
    document.getElementById("b-notas").style.display = "block";
    document.getElementById("a-tareas").style.display = "block";
    document.getElementById("b-tareas").style.display = "block";

    document.getElementById("linkNotas2A").style.display = "inline-block";
    document.getElementById("linkNotas2B").style.display = "inline-block";
    document.getElementById("linkTareas2A").style.display = "inline-block";
    document.getElementById("linkTareas2B").style.display = "inline-block";

    actualizarNotas2A();
    actualizarNotas2B();
    renderTablaAsistencia("");
}

// Configurar vista para FAMILIA
function configurarVistaFamilia() {
    const textoRol = document.getElementById("textoRol");
    const resumen = document.getElementById("resumenEstudiante");

    textoRol.textContent = "Acceso: Madre, padre o tutor";
    resumen.style.display = "block";
    resumen.textContent = `Visualizando información de: ${alumnoActual} (${paraleloActual})`;

    // Ocultamos selector de alumno, pero mantenemos trimestre/área
    const selectAlumno2A = document.getElementById("filtroAlumno2A");
    const selectAlumno2B = document.getElementById("filtroAlumno2B");
    if (selectAlumno2A) selectAlumno2A.style.display = "none";
    if (selectAlumno2B) selectAlumno2B.style.display = "none";

    if (paraleloActual === "2ºA") {
        document.getElementById("a-notas").style.display = "block";
        document.getElementById("b-notas").style.display = "none";
        document.getElementById("a-tareas").style.display = "block";
        document.getElementById("b-tareas").style.display = "none";

        document.getElementById("linkNotas2A").style.display = "inline-block";
        document.getElementById("linkNotas2B").style.display = "none";
        document.getElementById("linkTareas2A").style.display = "inline-block";
        document.getElementById("linkTareas2B").style.display = "none";

        actualizarNotas2A();
        renderTablaNotas("tablaNotas2B", datosNotas2B, { alumno: "" });
    } else {
        document.getElementById("a-notas").style.display = "none";
        document.getElementById("b-notas").style.display = "block";
        document.getElementById("a-tareas").style.display = "none";
        document.getElementById("b-tareas").style.display = "block";

        document.getElementById("linkNotas2A").style.display = "none";
        document.getElementById("linkNotas2B").style.display = "inline-block";
        document.getElementById("linkTareas2A").style.display = "none";
        document.getElementById("linkTareas2B").style.display = "inline-block";

        actualizarNotas2B();
        renderTablaNotas("tablaNotas2A", datosNotas2A, { alumno: "" });
    }

    renderTablaAsistencia(alumnoActual);
}

// Manejo de acceso
document.getElementById("btnIngresar").addEventListener("click", () => {
    const codigo = document.getElementById("codigoAcceso").value.trim();
    const mensajeError = document.getElementById("mensajeError");
    const rolSeleccionado = document.querySelector('input[name="rol"]:checked').value;

    if (rolSeleccionado === "docente") {
        if (codigo !== CODIGO_DOCENTE) {
            mensajeError.textContent = "Código incorrecto. Verifique e intente nuevamente.";
            return;
        }
        rolActual = "docente";
        mensajeError.textContent = "";
        document.getElementById("pantalla-acceso").style.display = "none";
        document.getElementById("app").style.display = "block";
        configurarVistaDocente();
    } else {
        const codigoNorm = normalizarCodigoFamilia(codigo);
        const info = codigosFamilia[codigoNorm];
        if (!info) {
            mensajeError.textContent = "Código de estudiante no válido. Revise el primer apellido y nombre.";
            return;
        }
        rolActual = "familia";
        alumnoActual = info.alumno;
        paraleloActual = info.paralelo;
        mensajeError.textContent = "";
        document.getElementById("pantalla-acceso").style.display = "none";
        document.getElementById("app").style.display = "block";
        configurarVistaFamilia();
    }
});

// Inicialización
document.addEventListener("DOMContentLoaded", () => {
    // Selectores de alumnos para notas (modo docente)
    llenarSelectAlumnos("filtroAlumno2A", datosNotas2A);
    llenarSelectAlumnos("filtroAlumno2B", datosNotas2B);

    // Listeners filtros notas 2ºA
    document.getElementById("filtroAlumno2A").addEventListener("change", actualizarNotas2A);
    document.getElementById("filtroTrimestre2A").addEventListener("change", actualizarNotas2A);
    document.getElementById("filtroArea2A").addEventListener("change", actualizarNotas2A);

    // Listeners filtros notas 2ºB
    document.getElementById("filtroAlumno2B").addEventListener("change", actualizarNotas2B);
    document.getElementById("filtroTrimestre2B").addEventListener("change", actualizarNotas2B);
    document.getElementById("filtroArea2B").addEventListener("change", actualizarNotas2B);

    // Botones tareas recientes / todas
    document.querySelectorAll(".btn-tareas").forEach(btn => {
        btn.addEventListener("click", () => {
            const tablaId = btn.dataset.target;
            const modo = btn.dataset.modo;
            filtrarTareas(tablaId, modo);
        });
    });

    // Render inicial (no visible hasta que se ingrese)
    renderTablaNotas("tablaNotas2A", datosNotas2A, {});
    renderTablaNotas("tablaNotas2B", datosNotas2B, {});
    renderTablaAsistencia("");
});
</script>

</body>
</html>
